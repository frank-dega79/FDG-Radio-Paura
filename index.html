<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDG Radio Paura</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1088/1088513.png">
    <style>
        :root {
            --neon-primary: #ff00ff;
            --neon-secondary: #00d2ff;
            --bg-color: #0a0a0c;
        }

        .modalita-paura {
            --neon-primary: #00ff41; 
            --neon-secondary: #0d4b1a;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            color: var(--neon-secondary);
            transition: all 0.5s ease;
        }

        body::before {
            content: " ";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 10;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .player-container {
            background: #111;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 0 30px var(--neon-secondary);
            text-align: center;
            width: 360px;
            border: 1px solid #333;
            z-index: 20;
        }

        h2 { 
            text-transform: uppercase; 
            letter-spacing: 5px; 
            font-size: 1.2rem; 
            margin-bottom: 25px; 
            color: var(--neon-primary);
            text-shadow: 0 0 8px var(--neon-primary);
        }

        .station-display {
            background: #000;
            padding: 15px;
            border: 1px solid #333;
            margin-bottom: 20px;
            border-radius: 5px;
            color: var(--neon-secondary);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.9rem;
            min-height: 20px;
        }

        .station-selector {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            background: #000;
            color: var(--neon-secondary);
            border: 1px solid var(--neon-primary);
            outline: none;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }

        #visualizer {
            width: 100%;
            height: 100px;
            background: #000;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--neon-primary);
        }

        .controls { display: flex; justify-content: center; gap: 20px; align-items: center; }

        .controls button {
            background: transparent;
            border: 2px solid var(--neon-secondary);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            color: var(--neon-secondary);
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
        }

        .controls button:hover { background: var(--neon-secondary); color: #000; box-shadow: 0 0 20px var(--neon-secondary); }

        #pauraBtn {
            background: transparent;
            border: 1px solid red;
            color: red;
            padding: 5px 10px;
            font-size: 0.6rem;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 3px;
        }

        .volume-container { margin-top: 25px; display: flex; align-items: center; gap: 10px; }
        input[type=range] { flex-grow: 1; accent-color: var(--neon-primary); }
    </style>
</head>
<body>

<div class="player-container">
    <h2>FDG Radio Paura</h2>
    
    <div id="stationDisplay" class="station-display">SISTEMA PRONTO</div>
    
    <select id="stationSelect" class="station-selector">
        <optgroup label="Synthwave & Retro">
            <option value="https://stream.nightride.fm/nightride.mp3">Nightride FM</option>
            <option value="https://stream.nightride.fm/chillsynth.mp3">Chillsynth FM</option>
            <option value="https://stream.nightride.fm/darksynth.mp3">Darksynth FM</option>
            <option value="https://stream.synthwaveradio.eu/listen/synthwaveradio.eu/radio.mp3">Synthwave Radio</option>
        <optgroup label="Dance & Progressive">
            <option value="https://radiorecord.hostingradio.ru/rmx96.aacp">Radio Record Remix</option>
        </optgroup>
    </select>

    <canvas id="visualizer"></canvas>

    <div class="controls">
        <button id="playPauseBtn">PLAY</button>
        <button id="pauraBtn">MODALITÀ PAURA</button>
    </div>

    <div class="volume-container">
        <span>VOL</span>
        <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0.5">
    </div>
</div>

<script>
    const stationSelect = document.getElementById('stationSelect');
    const stationDisplay = document.getElementById('stationDisplay');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const pauraBtn = document.getElementById('pauraBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const canvas = document.getElementById('visualizer');
    const canvasCtx = canvas.getContext('2d');

    let audio = new Audio();
    audio.crossOrigin = "anonymous";
    let isPlaying = false;
    let audioCtx, analyser, source, dataArray, bufferLength;
    let wakeLock = null;

    // Funzione Wake Lock per non far spegnere lo schermo
    async function requestWakeLock() {
        try {
            if ('wakeLock' in navigator) {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log("WakeLock Attivo");
            }
        } catch (err) {
            console.log("WakeLock Errore");
        }
    }

    // Toggle Modalità Paura
    pauraBtn.addEventListener('click', () => {
        document.body.classList.toggle('modalita-paura');
        pauraBtn.textContent = document.body.classList.contains('modalita-paura') ? "MODALITÀ SYNTH" : "MODALITÀ PAURA";
    });

    function initVisualizer() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            source = audioCtx.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            analyser.fftSize = 64;
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            draw();
        }
    }

    function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(dataArray);
        canvasCtx.fillStyle = '#000';
        canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
        let barWidth = (canvas.width / bufferLength) * 2.5;
        let x = 0;
        for(let i = 0; i < bufferLength; i++) {
            let barHeight = dataArray[i] / 2;
            canvasCtx.fillStyle = document.body.classList.contains('modalita-paura') ? '#00ff41' : `rgb(0, ${barHeight + 100}, 255)`;
            canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
            x += barWidth + 2;
        }
    }

    playPauseBtn.addEventListener('click', async () => {
        if (!isPlaying) {
            initVisualizer();
            audio.src = stationSelect.value;
            audio.play();
            playPauseBtn.textContent = 'STOP';
            stationDisplay.textContent = "ON AIR: " + stationSelect.options[stationSelect.selectedIndex].text;
            
            // Attiva blocco schermo
            await requestWakeLock();
            
            isPlaying = true;
        } else {
            audio.pause();
            audio.src = "";
            playPauseBtn.textContent = 'PLAY';
            stationDisplay.textContent = "PAUSA";
            
            // Rilascia blocco schermo
            if (wakeLock !== null) {
                await wakeLock.release();
                wakeLock = null;
            }
            
            isPlaying = false;
        }
    });

    stationSelect.addEventListener('change', () => {
        if (isPlaying) {
            audio.src = stationSelect.value;
            audio.play();
            stationDisplay.textContent = "ON AIR: " + stationSelect.options[stationSelect.selectedIndex].text;
        } else {
            stationDisplay.textContent = "PRONTO: " + stationSelect.options[stationSelect.selectedIndex].text;
        }
    });

    volumeSlider.addEventListener('input', (e) => audio.volume = e.target.value);
</script>
</body>
</html>


